<p>ğŸ“¢ë‹¤ë¥¸ ë˜ìƒˆê¹€ ë¬¸ì œë“¤ì€ í…œí”Œë¦¿ íŒŒì¼ë§Œ ìˆ˜ì •í•˜ê±°ë‚˜ well-known ë¬¸ì œë“¤ì´ë¼ êµ¬ê¸€ë§í•˜ë©´ ë°”ë¡œ í•´ê²°ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— ìƒëµí•˜ì˜€ìœ¼ë‹ˆ, ê¶ê¸ˆí•˜ì‹œë©´ ì±…ì„ êµ¬ë§¤í•´ì„œ ì‚´í´ë³´ì‹œê¸¸ ë°”ëë‹ˆë‹¤.</p>
<h1 id="ğŸ§‘ğŸ’¼ê´€ë¦¬ìë§Œ-ì§ˆë¬¸-ë“±ë¡-ê°€ëŠ¥í•˜ë„ë¡-ê¸°ëŠ¥-ë³€ê²½í•˜ê¸°">ğŸ§‘â€ğŸ’¼ê´€ë¦¬ìë§Œ ì§ˆë¬¸ ë“±ë¡ ê°€ëŠ¥í•˜ë„ë¡ ê¸°ëŠ¥ ë³€ê²½í•˜ê¸°</h1>
<p>ê¸°ì¡´ì—ëŠ” ëª¨ë“  ë¡œê·¸ì¸ ì‚¬ìš©ìê°€ ì§ˆë¬¸ì„ ë“±ë¡í•  ìˆ˜ ìˆì—ˆì§€ë§Œ,
board-adminì´ë¼ëŠ” ë¸Œëœì¹˜ë¥¼ ë”°ë¡œ íŒŒì„œ admin ê³„ì •ë§Œ ì§ˆë¬¸ì„ ë“±ë¡í•  ìˆ˜ ìˆë„ë¡ ê¸°ëŠ¥ì„ ë³€ê²½í•˜ì˜€ë‹¤.</p>
<h2 id="âš¡ï¸ìš”êµ¬ì‚¬í•­">âš¡ï¸ìš”êµ¬ì‚¬í•­</h2>
<ol>
<li>usernameì´ 'admin'ì¸ ê²½ìš°ì—ë§Œ &quot;ì§ˆë¬¸ ë“±ë¡í•˜ê¸°&quot; ë²„íŠ¼ì„ ëˆŒëŸ¬ ê¸€ ì‘ì„± ê°€ëŠ¥</li>
<li>ì¼ë°˜ ì‚¬ìš©ìê°€ ì ‘ê·¼í•˜ë©´ ì•Œë¦¼(alert)ìœ¼ë¡œ ì•ˆë‚´ ë©”ì‹œì§€ ì¶œë ¥</li>
</ol>
<h2 id="ğŸ› ï¸-êµ¬í˜„-ë°©ë²•">ğŸ› ï¸ êµ¬í˜„ ë°©ë²•</h2>
<p>ë¨¼ì € ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ê¶Œí•œì„ ì²´í¬í•œë‹¤.</p>
<h3 id="ğŸ’»questioncontroller">ğŸ’»QuestionController</h3>
<pre><code class="language-java">@PreAuthorize(&quot;hasRole('ADMIN')&quot;)
@GetMapping(&quot;/create&quot;)
public String showQuestionForm(QuestionForm questionForm) {
    return &quot;question_form&quot;;
}</code></pre>
<ul>
<li><code>@PreAuthorize(&quot;hasRole('ADMIN')&quot;)</code>ë¡œ ê´€ë¦¬ìë§Œ &quot;ì§ˆë¬¸ ë“±ë¡í•˜ê¸°&quot; ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê¸€ ì‘ì„± ê¸°ëŠ¥ì— ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •í•˜ì˜€ë‹¤.</li>
</ul>
<p>ğŸš¨ê·¸ëŸ°ë°, ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì—ì„œëŠ” ì¼ë°˜ ì‚¬ìš©ìê°€ íŠ¹ì • ê¶Œí•œì´ ìˆëŠ” APIë¥¼ í˜¸ì¶œí•˜ë©´ <span style="color: red;"><strong>Whitelabel error í™”ë©´ìœ¼ë¡œ 403 ì—ëŸ¬ í˜ì´ì§€ë§Œ ë…¸ì¶œ</strong></span>ì‹œì¼œ ì‚¬ìš©ì UXê°€ ë§¤ìš° ë–¨ì–´ì§„ë‹¤.
ğŸ”¨ë”°ë¼ì„œ ë‚˜ëŠ” ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ alert ì°½ìœ¼ë¡œ í‘œì‹œí•˜ê³  ì‹¶ì–´ì„œ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ AccessDeniedHandlerì™€ HttpSessionì„ í™œìš©í•´ ì‚¬ìš©ì UXë¥¼ ê°œì„ ì‹œì¼°ë‹¤.</p>
<h3 id="ğŸ’»customaccessdeniedhandler">ğŸ’»CustomAccessDeniedHandler</h3>
<pre><code class="language-java">@Component
public class CustomAccessDeniedHandler implements AccessDeniedHandler {
    @Override
    public void handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException accessDeniedException) throws IOException {
        request.getSession().setAttribute(&quot;userRoleError&quot;, &quot;í˜„ì¬ ê´€ë¦¬ìë§Œ ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.&quot;);
        response.sendRedirect(&quot;/question/list&quot;);
    }
}</code></pre>
<ul>
<li>handle ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë”©í•´ì„œ ì„œë¸”ë¦¿ì˜ requestë¥¼ í™œìš©í•´ì„œ ì„¸ì…˜ì— ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë‹´ì•˜ê³ , responseë¡œ ë£¨íŠ¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ ì‹œì¼°ë‹¤.</li>
</ul>
<p>ê·¸ëŸ°ë°, ë£¨íŠ¸ í˜ì´ì§€ëŠ” ì¼ë°˜ ì‚¬ìš©ì/ê´€ë¦¬ì ìƒê´€ì—†ì´ ëª¨ë‘í•œí…Œ ë³´ì—¬ì¤˜ì•¼ í•˜ëŠ”ë°, ìœ„ì˜ í•¸ë“¤ëŸ¬ì—ì„œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì„¸ì…˜ì— ë‹´ì•˜ê¸° ë•Œë¬¸ì— ì¼ë°˜ ì‚¬ìš©ìê°€ &quot;ì§ˆë¬¸ ë“±ë¡í•˜ê¸°&quot; ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œë§Œ AccessDeniedHandlerê°€ ë™ì‘í•´ì„œ handle()ì„ í˜¸ì¶œí•˜ê³  ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ <strong>SecurityConfig í´ë˜ìŠ¤ íŒŒì¼ê³¼ ì§ˆë¬¸ ì»¨íŠ¸ë¡¤ëŸ¬</strong>ì—ì„œ ì¶”ê°€ì ì¸ ì¡°ì¹˜ê°€ í•„ìš”í•˜ë‹¤.</p>
<h3 id="ğŸ’»securityconfig">ğŸ’»SecurityConfig</h3>
<pre><code class="language-java">@Configuration
@EnableWebSecurity
@EnableMethodSecurity
@RequiredArgsConstructor
public class SecurityConfig {
    private final AccessDeniedHandler customAccessDeniedHandler;

    @Bean
    SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        // ì¸ì¦ë˜ì§€ ì•Šì€ ëª¨ë“  í˜ì´ì§€ì˜ ìš”ì²­ì„ í—ˆë½
        http
                .authorizeHttpRequests(authorizeHttpRequests -&gt; authorizeHttpRequests.requestMatchers(new AntPathRequestMatcher(&quot;/**&quot;)).permitAll())
                .formLogin(formLogin -&gt; formLogin.loginPage(&quot;/user/login&quot;)
                        .defaultSuccessUrl(&quot;/&quot;)) // ë¡œê·¸ì¸ì— ì„±ê³µí•˜ë©´ ë£¨íŠ¸ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸;
                .exceptionHandling(exceptionHandling -&gt;
                        exceptionHandling
                                .accessDeniedHandler(customAccessDeniedHandler)

                )
                .logout(logout -&gt; logout
                        .logoutRequestMatcher(new AntPathRequestMatcher(&quot;/user/logout&quot;))
                        .logoutSuccessUrl(&quot;/&quot;)
                        .invalidateHttpSession(true));
        return http.build();
    }

    @Bean
    PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) throws Exception {
        return authenticationConfiguration.getAuthenticationManager();
    }
}</code></pre>
<ul>
<li>ğŸ’¡Spring Security 6.1+ì—ì„œëŠ” exceptionHandlingë¥¼ ë©”ì„œë“œ ì²´ì´ë‹ ë°©ì‹ì´ ì•„ë‹ˆë¼ ìœ„ì™€ ê°™ì´ ëŒë‹¤ í‘œí˜„ì‹ìœ¼ë¡œë§Œ ì‚¬ìš©í•´ì•¼ <span style="color: blue;"><strong>ì»´íŒŒì¼ ì—ëŸ¬</strong></span>ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.</li>
<li>ìœ„ì˜ <code>@Component</code>ë¡œ ë“±ë¡í•œ CustomAccessDeniedHandlerë¥¼ ìƒì„±ì ì£¼ì… ë°©ì‹ìœ¼ë¡œ ì£¼ì…í•´ì„œ ì‚¬ìš©í•˜ì˜€ë‹¤.</li>
</ul>
<h3 id="ğŸ’»questioncontroller-1">ğŸ’»QuestionController</h3>
<pre><code class="language-java">@GetMapping(&quot;/list&quot;)
public String list(Model model, HttpServletRequest request, ...) {
    Object userRoleError = request.getSession().getAttribute(&quot;userRoleError&quot;);
    if (userRoleError != null) {
        model.addAttribute(&quot;userRoleError&quot;, userRoleError);
        request.getSession().removeAttribute(&quot;userRoleError&quot;);
    }
    // ...
    return &quot;question_list&quot;;
}</code></pre>
<ul>
<li>ì„¸ì…˜ì— ì„¤ì •í–ˆë˜ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ <code>getAttribute()</code>ë¡œ ê°€ì ¸ì™€ì„œ userRoleError ê°ì²´ê°€ nullì´ ì•„ë‹ ë•Œë§Œ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ëª¨ë¸ì— ë‹´ì•„ ë·° ê³„ì¸µì— ì „ë‹¬í•  ì¤€ë¹„ë¥¼ í•œë‹¤.<ul>
<li>ì¼íšŒì„±ìœ¼ë¡œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ëª¨ë¸ì— ë‹´ê³  <code>removeAttribute()</code>ë¡œ ì„¸ì…˜ì˜ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì œê±°í•œë‹¤.</li>
</ul>
</li>
</ul>
<h3 id="ğŸ’»question_listhtml">ğŸ’»question_list.html</h3>
<pre><code class="language-javascript">&lt;script th:inline=&quot;javascript&quot;&gt;
    var userRoleError = /*[[${userRoleError != null ? &quot;'&quot; + userRoleError + &quot;'&quot; : &quot;null&quot;}]]*/ &quot;null&quot;;
    if (userRoleError !== &quot;null&quot;) {
        alert(userRoleError);
    }
&lt;/script&gt;</code></pre>
<ul>
<li>ğŸ’¡ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ì— <code>th:inline=&quot;javascript&quot;</code>ì„ ë„£ìœ¼ë©´ userRoleError ìš°ê°’ì˜ ì£¼ì„ ì²˜ë¦¬ëœ ë¶€ë¶„ì´ ê°’ì´ ìˆìœ¼ë©´ <code>var userRoleError = 'í˜„ì¬ ê´€ë¦¬ìë§Œ ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';</code>ë¡œ ì¹˜í™˜í•´ì£¼ê³  ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ <code>var userRoleError = null;</code>ë¡œ ì¹˜í™˜ì´ ëœë‹¤.</li>
</ul>
<h2 id="âš¡ï¸-component-vs-bean-ì–¸ì œ-ì–´ë–¤-ê±¸-ì¨ì•¼-í• ê¹Œ">âš¡ï¸ @Component vs @Bean, ì–¸ì œ ì–´ë–¤ ê±¸ ì¨ì•¼ í• ê¹Œ?</h2>
<ol>
<li>@Component</li>
</ol>
<ul>
<li>í´ë˜ìŠ¤ ë ˆë²¨ì— ë¶™ì—¬ì„œ <strong>ì§ì ‘ ë§Œë“  í´ë˜ìŠ¤ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡</strong>í•  ë•Œ ì‚¬ìš©<ul>
<li>ì˜ˆì‹œ: ì§ì ‘ ë§Œë“  ì„œë¹„ìŠ¤, í•¸ë“¤ëŸ¬, ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ ë“±</li>
</ul>
</li>
<li>ìŠ¤í”„ë§ì´ ìë™ìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”(íƒìƒ‰)í•´ì„œ ë¹ˆìœ¼ë¡œ ë“±ë¡</li>
</ul>
<ol start="2">
<li>@Bean</li>
</ol>
<ul>
<li>SecurityConfig ê°™ì€ <code>@Configuration</code> í´ë˜ìŠ¤ <strong>ë‚´ë¶€ì˜ ë©”ì„œë“œì— ë¶™ì—¬
ë°˜í™˜ ê°ì²´ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡</strong>í•  ë•Œ ì‚¬ìš©<ul>
<li>ì£¼ë¡œ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°ì²´ë‚˜, ìƒì„±ì íŒŒë¼ë¯¸í„°ê°€ í•„ìš”í•œ ê°ì²´ë¥¼ ë“±ë¡í•  ë•Œ ì‚¬ìš©<pre><code class="language-java">@Bean
public PasswordEncoder passwordEncoder() {
return new BCryptPasswordEncoder();
}</code></pre>
</li>
</ul>
</li>
</ul>
<p>ğŸš¨@Componentì™€ @Beanì„ <span style="color: red;"><strong>ë™ì‹œì— ë“±ë¡</strong></span>í•˜ë©´ ê°™ì€ íƒ€ì…ì˜ ë¹ˆì´ 2ê°œ ìƒì„±ë˜ì–´ <span style="color: red;"><strong>Springì´ ì–´ë–¤ ë¹ˆì„ ì£¼ì…í•´ì•¼ í• ì§€ ëª°ë¼ì„œ ì—ëŸ¬ê°€ ë°œìƒ</strong></span>í•˜ê¸° ë•Œë¬¸ì—, ì§ì ‘ ë§Œë“  í´ë˜ìŠ¤ë©´ ì „ìë¥¼, ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë‚˜ ì„¤ì •ìš© ê°ì²´ë©´ í›„ìë¥¼ ì„ ì–¸í•˜ëŠ” ê²ƒì„ ì‹¤ë¬´ì—ì„œ ê¶Œì¥í•˜ê¸°ë„ í•œë‹¤.</p>